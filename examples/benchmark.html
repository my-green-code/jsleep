<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>JSleep Benchmark</title>
		<style>
			.benchmark-container {
				display: flex;
				gap: 20px;
				padding: 20px;
			}

			.benchmark-section {
				flex: 1;
				padding: 20px;
				border: 1px solid #ccc;
				border-radius: 8px;
			}

			.stats {
				background-color: #f8f9fa;
				padding: 15px;
				border-radius: 4px;
				margin: 10px 0;
			}

			.stat-item {
				display: flex;
				justify-content: space-between;
				margin: 5px 0;
			}

			.energy-meter {
				height: 20px;
				background-color: #e74c3c;
				transition: width 0.3s ease;
			}

			.energy-meter.efficient {
				background-color: #2ecc71;
			}

			.animation-grid {
				display: grid;
				grid-template-columns: repeat(3, 1fr);
				gap: 10px;
				margin: 20px 0;
			}

			.animated-item {
				height: 50px;
				background-color: #3498db;
				border-radius: 4px;
				animation: pulse 2s infinite;
			}

			.animated-item:nth-child(2n) {
				animation: rotate 3s infinite linear;
			}

			.animated-item:nth-child(3n) {
				animation: fade 2s infinite;
			}

			.controls {
				margin: 20px 0;
			}

			button {
				padding: 10px 20px;
				margin: 5px;
				background-color: #3498db;
				color: white;
				border: none;
				border-radius: 4px;
				cursor: pointer;
			}

			button:hover {
				background-color: #2980b9;
			}

			.api-status {
				margin-top: 10px;
				padding: 10px;
				background-color: #f8f9fa;
				border-radius: 4px;
			}

			@keyframes pulse {
				0% {
					transform: scale(1);
				}
				50% {
					transform: scale(1.2);
				}
				100% {
					transform: scale(1);
				}
			}

			@keyframes rotate {
				from {
					transform: rotate(0deg);
				}
				to {
					transform: rotate(360deg);
				}
			}

			@keyframes fade {
				0% {
					opacity: 1;
				}
				50% {
					opacity: 0.5;
				}
				100% {
					opacity: 1;
				}
			}
		</style>
	</head>
	<body>
		<h1>JSleep Energy Benchmark</h1>

		<div class="benchmark-container">
			<div class="benchmark-section">
				<h2>Without JSleep</h2>
				<div class="stats">
					<div class="stat-item">
						<span>CPU Usage:</span>
						<span id="cpu-without">0%</span>
					</div>
					<div class="stat-item">
						<span>Memory Usage:</span>
						<span id="memory-without">0 MB</span>
					</div>
					<div class="stat-item">
						<span>Network Calls:</span>
						<span id="network-without">0</span>
					</div>
					<div class="stat-item">
						<span>Energy Impact:</span>
						<div
							class="energy-meter"
							id="energy-without"
							style="width: 0%"
						></div>
					</div>
				</div>
				<div class="animation-grid" id="animations-without"></div>
				<div class="api-status" id="api-status-without">API Status: Ready</div>
			</div>

			<div class="benchmark-section">
				<h2>With JSleep</h2>
				<div class="stats">
					<div class="stat-item">
						<span>CPU Usage:</span>
						<span id="cpu-with">0%</span>
					</div>
					<div class="stat-item">
						<span>Memory Usage:</span>
						<span id="memory-with">0 MB</span>
					</div>
					<div class="stat-item">
						<span>Network Calls:</span>
						<span id="network-with">0</span>
					</div>
					<div class="stat-item">
						<span>Energy Impact:</span>
						<div class="energy-meter" id="energy-with" style="width: 0%"></div>
					</div>
				</div>
				<div class="animation-grid" id="animations-with"></div>
				<div class="api-status" id="api-status-with">API Status: Ready</div>
			</div>
		</div>

		<div class="controls">
			<button onclick="startBenchmark()">Start Benchmark</button>
			<button onclick="stopBenchmark()">Stop Benchmark</button>
			<button onclick="resetBenchmark()">Reset</button>
		</div>

		<script type="module">
			import JSleep from '../dist/index.js';

			// Initialize JSleep
			const jsleep = new JSleep({
				idleTimeout: 3000,
				reduceAnimations: true,
				stopNetworkCalls: true,
				reduceFPS: true,
			});

			// Create animation elements
			function createAnimationElements(containerId) {
				const container = document.getElementById(containerId);
				for (let i = 0; i < 9; i++) {
					const div = document.createElement('div');
					div.className = 'animated-item';
					container.appendChild(div);
				}
			}

			// Initialize both sections
			createAnimationElements('animations-without');
			createAnimationElements('animations-with');

			// Performance monitoring
			let benchmarkInterval;
			let startTime;
			let networkCallsWithout = 0;
			let networkCallsWith = 0;

			// Recursive API call function
			async function makeRecursiveApiCall(withJsleep = false) {
				const statusId = withJsleep ? 'api-status-with' : 'api-status-without';
				const statusElement = document.getElementById(statusId);
				const networkId = withJsleep ? 'network-with' : 'network-without';

				try {
					statusElement.textContent = 'API Status: Making request...';
					const response = await fetch(
						'https://jsonplaceholder.typicode.com/posts/1',
					);
					const data = await response.json();

					if (withJsleep) {
						networkCallsWith++;
						document.getElementById(networkId).textContent = networkCallsWith;
					} else {
						networkCallsWithout++;
						document.getElementById(networkId).textContent =
							networkCallsWithout;
					}

					statusElement.textContent = `API Status: Success (${data.id})`;

					// Make another call after a delay
					setTimeout(() => makeRecursiveApiCall(withJsleep), 2000);
				} catch (error) {
					statusElement.textContent = `API Status: Error - ${error.message}`;
				}
			}

			// Update performance metrics
			function updateMetrics() {
				const timeElapsed = (Date.now() - startTime) / 1000;

				// Simulate CPU usage (this is a simplified metric)
				const cpuWithout = Math.min(100, 30 + Math.random() * 20);
				const cpuWith = Math.min(100, 5 + Math.random() * 10);

				// Simulate memory usage (this is a simplified metric)
				const memoryWithout = Math.floor(100 + Math.random() * 50);
				const memoryWith = Math.floor(50 + Math.random() * 20);

				// Calculate energy impact (simplified metric)
				const energyWithout = Math.min(
					100,
					cpuWithout * 0.7 + memoryWithout * 0.3,
				);
				const energyWith = Math.min(100, cpuWith * 0.7 + memoryWith * 0.3);

				// Update metrics
				document.getElementById(
					'cpu-without',
				).textContent = `${cpuWithout.toFixed(1)}%`;
				document.getElementById('cpu-with').textContent = `${cpuWith.toFixed(
					1,
				)}%`;
				document.getElementById(
					'memory-without',
				).textContent = `${memoryWithout} MB`;
				document.getElementById('memory-with').textContent = `${memoryWith} MB`;

				const energyMeterWithout = document.getElementById('energy-without');
				const energyMeterWith = document.getElementById('energy-with');

				energyMeterWithout.style.width = `${energyWithout}%`;
				energyMeterWith.style.width = `${energyWith}%`;
				energyMeterWith.classList.toggle(
					'efficient',
					energyWith < energyWithout,
				);
			}

			// Make functions available globally
			window.startBenchmark = function () {
				startTime = Date.now();
				benchmarkInterval = setInterval(updateMetrics, 1000);
				makeRecursiveApiCall(false);
				makeRecursiveApiCall(true);
			};

			window.stopBenchmark = function () {
				clearInterval(benchmarkInterval);
			};

			window.resetBenchmark = function () {
				clearInterval(benchmarkInterval);
				networkCallsWithout = 0;
				networkCallsWith = 0;
				document.getElementById('network-without').textContent = '0';
				document.getElementById('network-with').textContent = '0';
				document.getElementById('cpu-without').textContent = '0%';
				document.getElementById('cpu-with').textContent = '0%';
				document.getElementById('memory-without').textContent = '0 MB';
				document.getElementById('memory-with').textContent = '0 MB';
				document.getElementById('energy-without').style.width = '0%';
				document.getElementById('energy-with').style.width = '0%';
				document.getElementById('api-status-without').textContent =
					'API Status: Ready';
				document.getElementById('api-status-with').textContent =
					'API Status: Ready';
			};
		</script>
	</body>
</html>
